@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Data</title>
    <link rel="stylesheet" href="~/css/Index.css" asp-append-version="true" />
    @* <script src="~/js/Index.js"></script> *@
    @* <script src="~/js/AddPage.js"></script> *@
</head>

<body>
    <div class="contains">

        <h1 class="h1" >Our Student</h1>

        <div >
            <div class ="SearchAdd">
            <label for="searchBox"></label>
                <input type="text" id="searchBox" oninput="filterTable()" placeholder="Search..." />
            </div>

            <div>
                <button onclick="AddData()" class="rounded-button">+Add</button>
            </div>
            
        </div>
        
    
        <div class="text-center" id="table-container">
           
            <table id="userTable" >
                <thead>
                    <tr class="first-row">
                        <th>FirstName</th>
                        <th>LastName</th>
                        <th>Gender</th>
                        <th>Age</th>
                        <th>Class</th>

                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    
        

    </div>

    
    
    <script>
        
        var users = JSON.parse(localStorage.getItem('users')) || [];
        // var table = document.getElementById('userTable');
        // var tbody = table.querySelector('tbody');
        var table = document.getElementById('userTable');
        // var tbody = table.querySelector('tbody');

        for (var i = 0; i < users.length; i++) {
            var user = users[i];
            var row = table.insertRow(-1);

            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);

            // var cell3 = row.insertCell(2);

            cell1.innerHTML = user.firstName;
            cell2.innerHTML = user.lastName;
            cell3.innerHTML = user.gender;
            cell4.innerHTML = user.age;
            cell5.innerHTML = user.sclass;



            if (i === 0) {
                row.classList.add('first-row-color');
            }

            row.addEventListener('click', function (event) {
                var rows = table.getElementsByTagName('tr');
                var firstRow = rows[0];

                // Reset background color for all rows
                for (var j = 0; j < rows.length; j++) {
                    rows[j].style.backgroundColor = 'window';
                }

                // Remove the color class from the first row
                // firstRow.classList.remove('first-row-color');

                // Set background color for the clicked row
                event.currentTarget.style.backgroundColor = '#eaf2c2';
            });


            /////////////////////////////////////////////////////////////

        // var users = JSON.parse(localStorage.getItem('users')) || [];

        // var table = document.getElementById('userTable');
        // var tbody = table.querySelector('tbody');
        // var headerRow = table.querySelector('thead tr');

        // headerRow.classList.add('default-color');

        // for (var i = 0; i < users.length; i++) {
        //     var user = users[i];
        //     var row = tbody.insertRow(-1);

        //     var cell1 = row.insertCell(0);
        //     var cell2 = row.insertCell(1);
        //     var cell3 = row.insertCell(2);
        //     var cell4 = row.insertCell(3);
        //     var cell5 = row.insertCell(4);

        //     cell1.innerHTML = user.firstName;
        //     cell2.innerHTML = user.lastName;
        //     cell3.innerHTML = user.gender;
        //     cell4.innerHTML = user.age;
        //     cell5.innerHTML = user.sclass;

        //     row.classList.add('default-color');

        //     if (i === 0) {
        //         row.classList.add('first-row-color');
        //     }

        //         row.addEventListener('click', function (event) {
        //         var rows = tbody.getElementsByTagName('tr');
        //         // tbody.rows[0].classList.remove('first-row-color');
        //         for (var j = 0; j < rows.length; j++) {
        //             rows[j].classList.remove('selected-color');
        //         }
        //         event.currentTarget.classList.add('selected-color');

        //       /*   var rowIndex = event.currentTarget.rowIndex - 1; */
        //         // console.log('Selected Row Index:', rowIndex);
        //     }
        //     );

            // Add double-click event listener`e


            row.addEventListener('dblclick', function (event) {
                var rowIndex = event.currentTarget.rowIndex - 1;
                editUser(rowIndex);
            });
        }

        // Add event listeners for header clicks
        var headerCells = table.querySelectorAll('thead th');
        headerCells.forEach(function (cell, index) {
            
            cell.addEventListener('click', function () {
                console.log(index);
                console.log("enter2");
                sortTable(index);
            });
        });

        function sortTable(columnIndex) {
            var table, rows, switching, i, x, y, shouldSwitch;
            table = document.getElementById('userTable');
            switching = true;

            while (switching) {
                switching = false;
                rows = table.rows;

                for (i = 1; i < rows.length - 1; i++) {
                    shouldSwitch = false;
                    x = rows[i].getElementsByTagName('td')[columnIndex];
                    y = rows[i + 1].getElementsByTagName('td')[columnIndex];

                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                }

                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                }
            }
           
        }

        function sortTable4(columnIndex) {
            var table, rows, switching, i, x, y, shouldSwitch;
            table = document.getElementById('userTable');
            switching = true;

            while (switching) {
                switching = false;
                rows = table.rows;

                for (i = 1; i < rows.length - 1; i++) {
                    shouldSwitch = false;
                    x = rows[i].getElementsByTagName('td')[columnIndex];
                    y = rows[i + 1].getElementsByTagName('td')[columnIndex];

                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                }

                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                }
            }

        }
        function AddData() {
            window.location.href = '/AddData';
        }

        function AddForm() {
            window.location.href = '/AddData';
        }


        function filterTable() {
            console.log("Enter1");
            var searchBox = document.getElementById('searchBox');
            var searchTerm = searchBox.value.toLowerCase();

            console.log('Search Term:', searchTerm);

             var table = document.getElementById('userTable');
            console.log("Enter00");
             var rows = table.getElementsByTagName('tr');


            console.log("Enter2");
            for (var i = 1; i < rows.length; i++) {
                console.log("Enter3");
                var row = rows[i];
                var cells = row.getElementsByTagName('td');
                var matchFound = false;
                var firstMatchFound = false;
                    // Check only first name, last name, and age
                    var columnsToSearch = [0, 1, 3]; 
                    console.log("Enter4");
                    console.log(matchFound);
                    for (var j = 0; j < columnsToSearch.length; j++) {
                    
                        console.log("Enter5");
                        var columnIndex = columnsToSearch[j];
                        var cellText = cells[columnIndex].textContent.toLowerCase();
                        console.log("Enter6");
                        console.log(cellText.includes(searchTerm));
                        if (cellText.includes(searchTerm)) {

                            matchFound = true;
                            break;
                            console.log("Enter7");
                        }
                    }
                    console.log("Enter8");
                    row.style.display = matchFound ? '' : 'none';


                // if (matchFound ) {
                //     row.style.backgroundColor = 'yellowgreen';
                // } else {
                //     row.style.backgroundColor = ''; // Reset background color for other rows
                // }
                    console.log(row.style.display);
            }
        }

        function editUser(index) {
            var userToEdit = users[index];
            var editUrl = '/Edit_Student?edit=true&index=' + index +
                '&firstName=' + encodeURIComponent(userToEdit.firstName) +
                '&lastName=' + encodeURIComponent(userToEdit.lastName) +
                '&gender=' + encodeURIComponent(userToEdit.gender) +
                '&dob=' + encodeURIComponent(userToEdit.dob) +
                '&age=' + encodeURIComponent(userToEdit.age) +
                '&sclass=' + encodeURIComponent(userToEdit.sclass) +
                '&address=' + encodeURIComponent(userToEdit.address);
            window.location.href = editUrl;
        } 
    </script>
</body>
</html>